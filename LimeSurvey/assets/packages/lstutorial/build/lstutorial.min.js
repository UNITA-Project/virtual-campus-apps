!function(t){"function"==typeof define&&define.amd?define(t):t()}((function(){"use strict";function _typeof(t){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function _createClass(t,e,o){return e&&_defineProperties(t.prototype,e),o&&_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}function _readOnlyError(t){throw new TypeError('"'+t+'" is read-only')}var document$1=window.document,Tour=function(){function t(e){_classCallCheck(this,t);var o=window.localStorage;if(this.objTemplates={},this.objTemplatesButtonTexts={prevButton:"Prev",nextButton:"Next",pauseButton:"Pause",resumeButton:"Resume",endTourButton:"End Tour"},this._options=$.extend(!0,{name:"tour",steps:[],container:"body",autoscroll:!0,keyboard:!0,storage:o,debug:!1,backdrop:!1,backdropContainer:"body",backdropPadding:0,redirect:!0,orphan:!1,duration:!1,delay:!1,basePath:"",template:null,localization:{buttonTexts:this.objTemplatesButtonTexts},framework:"bootstrap3",sanitizeWhitelist:[],sanitizeFunction:null,showProgressBar:!0,showProgressText:!0,getProgressBarHTML:null,getProgressTextHTML:null,afterSetState:function(t,e){},afterGetState:function(t,e){},afterRemoveState:function(t){},onStart:function(t){},onEnd:function(t){},onShow:function(t){},onShown:function(t){},onHide:function(t){},onHidden:function(t){},onNext:function(t){},onPrev:function(t){},onPause:function(t,e){},onResume:function(t,e){},onRedirectError:function(t){},onElementUnavailable:null,onPreviouslyEnded:null,onModalHidden:null},e),"bootstrap3"!==this._options.framework&&"bootstrap4"!==this._options.framework)throw this._debug("Invalid framework specified: "+this._options.framework),"Bootstrap Tourist: Invalid framework specified";if(this.objTemplates={bootstrap3:'<div class="popover" role="tooltip"> <div class="arrow"></div> <h3 class="popover-title"></h3> <div class="popover-content"></div> <div class="popover-navigation"> <div class="btn-group"> <button class="btn btn-sm btn-default" data-role="prev">&laquo; '+this._options.localization.buttonTexts.prevButton+'</button> <button class="btn btn-sm btn-default" data-role="next">'+this._options.localization.buttonTexts.nextButton+' &raquo;</button> <button class="btn btn-sm btn-default" data-role="pause-resume" data-pause-text="'+this._options.localization.buttonTexts.pauseButton+'" data-resume-text="'+this._options.localization.buttonTexts.resumeButton+'">'+this._options.localization.buttonTexts.pauseButton+'</button> </div> <button class="btn btn-sm btn-default" data-role="end">'+this._options.localization.buttonTexts.endTourButton+"</button> </div> </div>",bootstrap4:'<div class="popover" role="tooltip"> <div class="arrow"></div> <h3 class="popover-header"></h3> <div class="popover-body"></div> <div class="popover-navigation"> <div class="btn-group"> <button class="btn btn-sm btn-outline-secondary" data-role="prev">&laquo; '+this._options.localization.buttonTexts.prevButton+'</button> <button class="btn btn-sm btn-outline-secondary" data-role="next">'+this._options.localization.buttonTexts.nextButton+' &raquo;</button> <button class="btn btn-sm btn-outline-secondary" data-role="pause-resume" data-pause-text="'+this._options.localization.buttonTexts.pauseButton+'" data-resume-text="'+this._options.localization.buttonTexts.resumeButton+'">'+this._options.localization.buttonTexts.pauseButton+'</button> </div> <button class="btn btn-sm btn-outline-secondary" data-role="end">'+this._options.localization.buttonTexts.endTourButton+"</button> </div> </div>"},null===this._options.template?null!=this.objTemplates[this._options.framework]&&null!=this.objTemplates[this._options.framework]?(this._options.template=this.objTemplates[this._options.framework],this._debug("Using framework template: "+this._options.framework)):this._debug("Warning: "+this._options.framework+" specified for template (no template option set), but framework is unknown. Tour will not work!"):this._debug("Using custom template"),"function"==typeof this._options.sanitizeFunction)this._debug("Using custom sanitize function in place of bootstrap - security implications, be careful");else{this._options.sanitizeFunction=null,this._debug("Extending Bootstrap sanitize options");var n="bootstrap4"==this._options.framework&&void 0!==$.fn.popover.Constructor.Default.whiteList?$.fn.popover.Constructor.Default.whiteList:"bootstrap3"==this._options.framework&&void 0!==$.fn.popover.Constructor.DEFAULTS.whiteList?$.fn.popover.Constructor.DEFAULTS.whiteList:[],i=$.extend(!0,{},n);$.each({button:["data-role","style"],img:["style"],div:["style"]},(function(t,e){i[t]=i[t]||[],$.merge(i[t],e)})),$.each(this._options.sanitizeWhitelist,(function(t,e){i[t]=i[t]||[],$.merge(i[t],e)})),this._options.sanitizeWhitelist=i}return this._current=null,this.backdrops=[],this}return _createClass(t,[{key:"addSteps",value:function(t){for(var e=0,o=t.length;e<o;e++){var n=t[e];this.addStep(n)}return this}},{key:"addStep",value:function(t){return this._options.steps.push(t),this}},{key:"getStepCount",value:function(){return this._options.steps.length}},{key:"getStep",value:function(t){if(null!=this._options.steps[t])return"function"==typeof this._options.steps[t].element&&(this._options.steps[t].element=this._options.steps[t].element()),this._options.steps[t]=$.extend(!0,{id:"step-"+t,path:"",host:"",placement:"right",title:"",content:"<p></p>",next:t===this._options.steps.length-1?-1:t+1,prev:t-1,animation:!0,container:this._options.container,autoscroll:this._options.autoscroll,backdrop:this._options.backdrop,backdropContainer:this._options.backdropContainer,backdropPadding:this._options.backdropPadding,redirect:this._options.redirect,reflexElement:this._options.steps[t].element,preventInteraction:!1,orphan:this._options.orphan,duration:this._options.duration,delay:this._options.delay,template:this._options.template,showProgressBar:this._options.showProgressBar,showProgressText:this._options.showProgressText,getProgressBarHTML:this._options.getProgressBarHTML,getProgressTextHTML:this._options.getProgressTextHTML,onShow:this._options.onShow,onShown:this._options.onShown,onHide:this._options.onHide,onHidden:this._options.onHidden,onNext:this._options.onNext,onPrev:this._options.onPrev,onPause:this._options.onPause,onResume:this._options.onResume,onRedirectError:this._options.onRedirectError,onElementUnavailable:this._options.onElementUnavailable,onModalHidden:this._options.onModalHidden,internalFlags:{elementModal:null,elementModalOriginal:null,elementBootstrapSelectpicker:null}},this._options.steps[t]),this._options.steps[t]}},{key:"_setStepFlag",value:function(t,e,o){null!=this._options.steps[t]&&(this._options.steps[t].internalFlags[e]=o)}},{key:"_getStepFlag",value:function(t,e){if(null!=this._options.steps[t])return this._options.steps[t].internalFlags[e]}},{key:"init",value:function(){console.log("You should remove Tour.init() from your code. It's not required with Bootstrap Tourist")}},{key:"start",value:function(){var t=this;if(this.ended())return null!=this._options.onPreviouslyEnded&&"function"==typeof this._options.onPreviouslyEnded?(this._debug("Tour previously ended, exiting. Call tour.restart() to force restart. Firing onPreviouslyEnded()"),this._options.onPreviouslyEnded(this)):this._debug("Tour previously ended, exiting. Call tour.restart() to force restart"),this;this.setCurrentStep(),this._initMouseNavigation(),this._initKeyboardNavigation(),$(window).on("resize.tour-"+this._options.name,(function(){t.reshowCurrentStep()}));var e=this._makePromise(null!=this._options.onStart?this._options.onStart(this):Promise.resolve());return this._callOnPromiseDone(e,this.showStep,this._current),this}},{key:"next",value:function(){return this._callOnPromiseDone(this.hideStep(),this._showNextStep)}},{key:"prev",value:function(){return this._callOnPromiseDone(this.hideStep(),this._showPrevStep)}},{key:"goTo",value:function(t){this._debug("goTo step "+t);var e=this.hideStep();return this._callOnPromiseDone(e,this.showStep,t)}},{key:"end",value:function(){var t=this,e=this.hideStep();return this._callOnPromiseDone(e,(function(e){if($(document$1).off("click.tour-"+t._options.name),$(document$1).off("keyup.tour-"+t._options.name),$(window).off("resize.tour-"+t._options.name),$(window).off("scroll.tour-"+t._options.name),t._setState("end","yes"),t._clearTimer(),null!=t._options.onEnd)return t._options.onEnd(t)}))}},{key:"ended",value:function(){return"yes"==this._getState("end")}},{key:"restart",value:function(){return this._removeState("current_step"),this._removeState("end"),this._removeState("redirect_to"),this.start()}},{key:"pause",value:function(){var t=this.getStep(this._current);return t&&t.duration?(this._paused=!0,this._duration-=(new Date).getTime()-this._start,window.clearTimeout(this._timer),this._debug("Paused/Stopped step "+(this._current+1)+" timer ("+this._duration+" remaining)."),null!=t.onPause?t.onPause(this,this._duration):void 0):this}},{key:"resume",value:function(){var t=this,e=this.getStep(this._current);return e&&e.duration?(this._paused=!1,this._start=(new Date).getTime(),this._duration=this._duration||e.duration,this._timer=window.setTimeout((function(){return t._isLast()?t.next():t.end()}),this._duration),this._debug("Started step "+(this._current+1)+" timer with duration "+this._duration),null!=e.onResume&&this._duration!==e.duration?e.onResume(this,this._duration):void 0):this}},{key:"reshowCurrentStep",value:function(){this._debug("Reshowing current step "+this.getCurrentStepIndex());var t=this.hideStep();return this._callOnPromiseDone(t,this.showStep,this._current)}},{key:"hideStep",value:function(){var t=this,e=this.getStep(this.getCurrentStepIndex());if(e){this._clearTimer();var o=this._makePromise(null!=e.onHide?e.onHide(this,this.getCurrentStepIndex()):null),n=function(o){var n=$(e.element).data("bs.popover")||$(e.element).data("popover")?$(e.element):$("body");"bootstrap3"==t._options.framework&&n.popover("destroy"),"bootstrap4"==t._options.framework&&n.popover("dispose"),n.removeClass("tour-"+t._options.name+"-element tour-"+t._options.name+"-"+t.getCurrentStepIndex()+"-element").removeData("bs.popover"),e.reflex&&$(e.reflexElement).removeClass("tour-step-element-reflex").off(t._reflexEvent(e.reflex)+".tour-"+t._options.name),t._hideOverlayElement(e),t._unfixBootstrapSelectPickerZindex(e);var i=t._getStepFlag(t.getCurrentStepIndex(),"elementModalOriginal");if(null!=i&&(t._setStepFlag(t.getCurrentStepIndex(),"elementModalOriginal",null),e.element=i),null!=e.onHidden)return e.onHidden(t)},i=e.delay.hide||e.delay;return 0!=e.delay&&i>0?(this._debug("Wait "+i+" milliseconds to hide the step "+(this._current+1)),window.setTimeout((function(){return t._callOnPromiseDone(o,n)}),i)):this._callOnPromiseDone(o,n),o}}},{key:"showStep",value:function(t){var e=this;if(this.ended())return this._debug("Tour ended, showStep prevented."),null!=this._options.onEnd&&this._options.onEnd(this),this;var o=this.getStep(t);if(o){var n=t<this._current,i=this._makePromise(null!=o.onShow?o.onShow(this,t):null);this.setCurrentStep(t);var r=LS.ld.isFunction(o.path)?o.path():"string"==typeof o.path?e._options.basePath+o.path:o.path;if(!o.redirect||!this._isRedirect(o.host,r,document$1.location)||(this._redirect(o,t,r),this._isJustPathHashDifferent(o.host,r,document$1.location))){var s=null;!1===o.orphan&&($(o.element).hasClass("modal")||$(o.element).data("bs.modal"))&&(s=$(o.element),this._setStepFlag(this.getCurrentStepIndex(),"elementModalOriginal",o.element),o.element=$(o.element).find(".modal-content:first"));var a=$(o.element);if(null===s&&a.parents(".modal:first").length&&(s=a.parents(".modal:first")),s&&s.length>0){this._debug("Modal identified, onModalHidden callback available"),this._setStepFlag(t,"elementModal",s);var l=function n(){if(e._debug("Modal close triggered"),"function"==typeof o.onModalHidden){var i=o.onModalHidden(e,t);if(!1===i)return void e._debug("onModalHidden returned exactly false, tour step unchanged");if(Number.isInteger(i))return e._debug("onModalHidden returned int, tour moving to step "+i+1),$_modalObject.off("hidden.bs.modal",n),e.goTo(i);e._debug("onModalHidden did not return false or int, continuing tour")}return $_modalObject.off("hidden.bs.modal",n),e._isLast()?e.next():e.end()};s.off("hidden.bs.modal",l).on("hidden.bs.modal",l)}var u=function(i){if(e._isOrphan(o)){if(!1===o.orphan)return e._debug("Skip the orphan step "+(e._current+1)+".\nOrphan option is false and the element "+o.element+" does not exist or is hidden."),"function"==typeof o.onElementUnavailable&&(e._debug("Calling onElementUnavailable callback"),o.onElementUnavailable(e,e._current)),void(n?e._showPrevStep(!0):e._showNextStep(!0));e._debug("Show the orphan step "+(e._current+1)+". Orphans option is true.")}if(o.autoscroll&&!e._isOrphan(o)?e._scrollIntoView(t):e._showPopoverAndOverlay(t),o.duration)return e.resume()},p=o.delay.show||o.delay;if("[object Number]"==={}.toString.call(p)&&p>0)this._debug("Wait "+p+" milliseconds to show the step "+(this._current+1)),window.setTimeout((function(){return e._callOnPromiseDone(i,u)}),p);else if(o.delayOnElement){var h=function(){return"function"==typeof o.delayOnElement.delayElement?o.delayOnElement.delayElement():"element"==o.delayOnElement.delayElement?$(o.element):$(o.delayOnElement.delayElement)},d=h(),c=d.length>0?d.reduce((function(t,e){return t.push(e.tagName)}),[]).join(", "):d.prop("tagName"),f=o.delayOnElement.maxDelay?o.delayOnElement.maxDelay:2e3;f=f<250?251:f,this._debug("Wait for element "+c+" visible or max "+f+" milliseconds to show the step "+(this._current+1));var _=window.setInterval((function(){if(e._debug("Wait for element "+c+": checking..."),0===d.length&&(d=h()),d.is(":visible"))return e._debug("Wait for element "+c+": found, showing step"),window.clearInterval(_),_readOnlyError("delayFunc"),e._callOnPromiseDone(i,u)}),250);window.setTimeout((function(){if(_)return e._debug("Wait for element "+c+": max timeout reached without element found"),window.clearInterval(_),e._callOnPromiseDone(i,u)}),f)}else this._callOnPromiseDone(i,u);return i}}}},{key:"getCurrentStepIndex",value:function(){return this._current}},{key:"setCurrentStep",value:function(t){return null!=t?(this._current=t,this._setState("current_step",t)):(this._current=this._getState("current_step"),this._current=null===this._current?0:parseInt(this._current,10)),this}},{key:"_setState",value:function(t,e){if(this._options.storage){var o=this._options.name+"_"+t;try{this._options.storage.setItem(o,e)}catch(t){t.code===DOMException.QUOTA_EXCEEDED_ERR&&this._debug("LocalStorage quota exceeded. State storage failed.")}return this._options.afterSetState(o,e)}return null==this._state&&(this._state={}),this._state[t]=e}},{key:"_removeState",value:function(t){if(this._options.storage){var e=this._options.name+"_"+t;return this._options.storage.removeItem(e),this._options.afterRemoveState(e)}if(null!=this._state)return delete this._state[t]}},{key:"_getState",value:function(t){var e;if(this._options.storage){var o=this._options.name+"_"+t;e=this._options.storage.getItem(o)}else null!=this._state&&(e=this._state[t]);return null!==e&&"null"!==e||(e=null),this._options.afterGetState(t,e),e}},{key:"_showNextStep",value:function(t){var e=this;t=t||!1;var o=this.getStep(this._current),n=Promise.resolve();if(!1===t&&null!=o.onNext){var i=o.onNext(this);if(this._debug("Current steps onNext failed. Check onNext -> ",o.onNext),this._debug("Current result: ",i),!1===i)return this._debug("onNext callback returned false, preventing move to next step"),this.showStep(this._current);n=this._makePromise(i)}return this._callOnPromiseDone(n,(function(t){return e.showStep(e._current+1)}))}},{key:"_showPrevStep",value:function(t){var e=this;t=t||!1;var o=this.getStep(this._current),n=Promise.resolve();if(!1===t&&null!=o.onPrev){var i=o.onPrev(this);if(!1===i)return this._debug("onPrev callback returned false, preventing move to previous step"),this.showStep(this._current);n=this._makePromise(i)}return this._callOnPromiseDone(n,(function(t){return e.showStep(o.prev)}))}},{key:"_debug",value:function(){var t;if(this._options.debug)return(t=window.console.log).call.apply(t,[this,"[ Bootstrap Tour: '"+this._options.name+"' ] "].concat(Array.prototype.slice.call(arguments)))}},{key:"_isRedirect",value:function(t,e,o){if(null!=t&&""!==t&&("[object RegExp]"==={}.toString.call(t)&&!t.test(o.origin)||"[object String]"==={}.toString.call(t)&&this._isHostDifferent(t,o)))return!0;var n=[o.pathname,o.search,o.hash].join("");return null!=e&&""!==e&&("[object RegExp]"==={}.toString.call(e)&&!e.test(n)||"[object String]"==={}.toString.call(e)&&this._isPathDifferent(e,n))}},{key:"_isHostDifferent",value:function(t,e){switch({}.toString.call(t)){case"[object RegExp]":return!t.test(e.origin);case"[object String]":return this._getProtocol(t)!==this._getProtocol(e.href)||this._getHost(t)!==this._getHost(e.href);default:return!0}}},{key:"_isPathDifferent",value:function(t,e){return this._getPath(t)!==this._getPath(e)||!this._equal(this._getQuery(t),this._getQuery(e))||!this._equal(this._getHash(t),this._getHash(e))}},{key:"_isJustPathHashDifferent",value:function(t,e,o){if(null!=t&&""!==t&&this._isHostDifferent(t,o))return!1;var n=[o.pathname,o.search,o.hash].join("");return"[object String]"==={}.toString.call(e)&&(this._getPath(e)===this._getPath(n)&&this._equal(this._getQuery(e),this._getQuery(n))&&!this._equal(this._getHash(e),this._getHash(n)))}},{key:"_redirect",value:function(t,e,o){if(LS.ld.isFunction(t.redirect))return t.redirect.call(this,o);var n="[object String]"==={}.toString.call(t.host)?""+t.host+o:o;return this._debug("Redirect to "+n),this._getState("redirect_to")!==""+e?(this._setState("redirect_to",""+e),document$1.location.href=n):(this._debug("Error redirection loop to "+o),this._removeState("redirect_to"),null!=t.onRedirectError?t.onRedirectError(this):void 0)}},{key:"_isOrphan",value:function(t){var e=1==t.orphan||null==t.element||!$(t.element).length||$(t.element).is(":hidden")&&"http://www.w3.org/2000/svg"!==$(t.element)[0].namespaceURI;return this._debug("It seems this element is an orphan -> ",t),e}},{key:"_isLast",value:function(){return this._current<this._options.steps.length-1}},{key:"_showPopoverAndOverlay",value:function(t){if(this.getCurrentStepIndex()===t&&!this.ended()){var e=this.getStep(t);return e.backdrop&&this._showOverlayElements(e),this._fixBootstrapSelectPickerZindex(e),this._showPopover(e,t),null!=e.onShown&&e.onShown(this),this}}},{key:"_showPopover",value:function(t,e){var o=this,n=this._isOrphan(t);if(0==$(document$1).find(".popover.tour-"+this._options.name+".tour-"+this._options.name+"-"+this.getCurrentStepIndex()).length){$(".tour-"+this._options.name).remove(),t.template=this._template(t,e),n&&(t.element="body",t.placement="top");var i=$(t.element);i.addClass("tour-"+this._options.name+"-element tour-"+this._options.name+"-"+e+"-element"),t.reflex&&!n&&$(t.reflexElement).addClass("tour-step-element-reflex").off(this._reflexEvent(t.reflex)+".tour-"+this._options.name).on(this._reflexEvent(t.reflex)+".tour-"+this._options.name,(function(t){return o._isLast()?o.next():o.end()}));var r=parseInt((e+1)/this.getStepCount()*100),s=t.title,a=t.content;t.showProgressBar&&(a="function"==typeof t.getProgressBarHTML?t.getProgressBarHTML(r)+a:'<div class="progress"><div class="progress-bar progress-bar-striped" role="progressbar" style="width: '+r+'%;"></div></div>'+a),t.showProgressText&&("function"==typeof t.getProgressTextHTML?s+=t.getProgressTextHTML(e,r,this.getStepCount()):("bootstrap3"==this._options.framework&&(s+='<span class="pull-left">'+(e+1)+"/"+this.getStepCount()+"</span>"),"bootstrap4"==this._options.framework&&(s+='<span class="float-left">'+(e+1)+"/"+this.getStepCount()+"</span>")));var l={placement:t.placement,trigger:"manual",title:s,content:a,html:!0,whiteList:this._options.sanitizeWhitelist,sanitizeFn:this._options.sanitizeFunction,animation:t.animation,container:t.container,template:t.template,selector:t.element};"bootstrap4"==this._options.framework&&(n?l.offset=function(t){var e=Math.max(0,($(window).height()-t.popper.height)/2),o=Math.max(0,($(window).width()-t.popper.width)/2);return t.popper.position="fixed",t.popper.top=e,t.popper.bottom=e+t.popper.height,t.popper.left=o,t.popper.right=e+t.popper.width,t}:l.selector="#"+t.element[0].id),"bootstrap4"==this._options.framework&&0==n&&(l.selector="#"+t.element[0].id),i.popover(l),i.popover("show");var u=null;"bootstrap3"==this._options.framework&&(u=i.data("bs.popover")?i.data("bs.popover").tip():i.data("popover").tip(),"fixed"===i.css("position")&&u.css("position","fixed"),n?(this._center(u),u.css("position","fixed")):this._reposition(u,t)),"bootstrap4"==this._options.framework&&(u=$(i.data("bs.popover")?i.data("bs.popover").getTipElement():i.data("popover").getTipElement())),u.attr("id",t.id),this._debug("Step "+(this._current+1)+" of "+this._options.steps.length)}}},{key:"_template",value:function(t,e){var o=this._isOrphan(t)&&!LS.ld.isBoolean(t.orphan)?(t.orphan,_readOnlyError("template")):t.template,n=$.isFunction(o)?$(o(e,t)):$(o),i=n.find(".popover-navigation"),r=i.find('[data-role="prev"]'),s=i.find('[data-role="next"]'),a=i.find('[data-role="pause-resume"]');return this._isOrphan(t)&&n.addClass("orphan"),n.addClass("tour-"+this._options.name+" tour-"+this._options.name+"-"+e),t.reflex&&n.addClass("tour-"+this._options.name+"-reflex"),t.prev<0&&r.addClass("disabled").prop("disabled",!0).prop("tabindex",-1),t.next<0&&s.addClass("disabled").prop("disabled",!0).prop("tabindex",-1),t.reflexOnly&&s.hide(),t.duration||a.remove(),n.clone().wrap("<div>").parent().html()}},{key:"_reflexEvent",value:function(t){return LS.ld.isBoolean(t)?"click":t}},{key:"_reposition",value:function(t,e){var o=t[0].offsetWidth,n=t[0].offsetHeight,i=t.offset(),r=i.left,s=i.top,a=$(document$1).height()-i.top-t.outerHeight();a<0&&(i.top=i.top+a);var l=$("html").outerWidth()-i.left-t.outerWidth();if(l<0&&(i.left=i.left+l),i.top<0&&(i.top=0),i.left<0&&(i.left=0),t.offset(i),"bottom"===e.placement||"top"===e.placement){if(r!==i.left)return this._replaceArrow(t,2*(i.left-r),o,"left")}else if(s!==i.top)return this._replaceArrow(t,2*(i.top-s),n,"top")}},{key:"_center",value:function(t){return t.css("top",$(window).outerHeight()/2-t.outerHeight()/2),t.css("left",$(window).outerWidth()/2-t.outerWidth()/2)}},{key:"_replaceArrow",value:function(t,e,o,n){return t.find(".arrow").css(n,e?50*(1-e/o)+"%":"")}},{key:"_scrollIntoView",value:function(t){var e=this,o=this.getStep(t),n=$(o.element);if(this._isOrphan(o))return this._showPopoverAndOverlay(t);if(!n.length)return this._showPopoverAndOverlay(t);var i=$(window),r=n.offset().top,s=n.outerHeight(),a=i.height(),l=0;switch(o.placement){case"top":l=Math.max(0,r-a/2);break;case"left":case"right":l=Math.max(0,r+s/2-a/2);break;case"bottom":l=Math.max(0,r+s-a/2)}this._debug("Scroll into view. ScrollTop: "+l+". Element offset: "+r+". Window height: "+a+".");var u=0;return $("body, html").stop(!0,!0).animate({scrollTop:Math.ceil(l)},(function(){if(2==++u)return e._showPopoverAndOverlay(t),e._debug("Scroll into view.\nAnimation end element offset: "+n.offset().top+".\nWindow height: "+i.height()+".")}))}},{key:"_onScroll",value:function(t,e){return $(window).on("scroll.tour-"+this._options.name,(function(){return clearTimeout(e),e=setTimeout(t,100)}))}},{key:"_initMouseNavigation",value:function(){var t=this;return $(document$1).off("click.tour-"+this._options.name,".popover.tour-"+this._options.name+" *[data-role='prev']").off("click.tour-"+this._options.name,".popover.tour-"+this._options.name+" *[data-role='next']").off("click.tour-"+this._options.name,".popover.tour-"+this._options.name+" *[data-role='end']").off("click.tour-"+this._options.name,".popover.tour-"+this._options.name+" *[data-role='pause-resume']").on("click.tour-"+this._options.name,".popover.tour-"+this._options.name+" *[data-role='next']",(function(e){return e.preventDefault(),t.next()})).on("click.tour-"+this._options.name,".popover.tour-"+this._options.name+" *[data-role='prev']",(function(e){if(e.preventDefault(),t._current>0)return t.prev()})).on("click.tour-"+this._options.name,".popover.tour-"+this._options.name+" *[data-role='end']",(function(e){return e.preventDefault(),t.end()})).on("click.tour-"+this._options.name,".popover.tour-"+this._options.name+" *[data-role='pause-resume']",(function(e){return e.preventDefault(),$this=$(e.target),$this.text(t._paused?$this.data("pause-text"):$this.data("resume-text")),t._paused?t.resume():t.pause()}))}},{key:"_initKeyboardNavigation",value:function(){var t=this;if(this._options.keyboard)return $(document$1).on("keyup.tour-"+this._options.name,(function(e){if(e.which)switch(e.which){case 39:return e.preventDefault(),t._isLast()?t.next():t.end();case 37:if(e.preventDefault(),t._current>0)return t.prev()}}))}},{key:"_makePromise",value:function(t){return t&&$.isFunction(t.then)?t:Promise.resolve()}},{key:"_callOnPromiseDone",value:function(t,e,o){var n=this;return t?t.then((function(){return e.call(n,o)})):e.call(this,o)}},{key:"_fixBootstrapSelectPickerZindex",value:function(t){if(!this._isOrphan(t)&&0==$(document$1).find(".popover.tour-"+this._options.name+".tour-"+this._options.name+"-"+this.getCurrentStepIndex()).length){var e="select"==$(t.element)[0].tagName.toLowerCase()?$(t.element):$(t.element).find("select:first");e.length>0&&e.parent().hasClass("bootstrap-select")&&(this._debug("Fixing Bootstrap SelectPicker"),e.parent().css("z-index","1101"),this._setStepFlag(this.getCurrentStepIndex(),"elementBootstrapSelectpicker",e))}}},{key:"_unfixBootstrapSelectPickerZindex",value:function(t){var e=this._getStepFlag(this.getCurrentStepIndex(),"elementBootstrapSelectpicker");e&&(this._debug("Unfixing Bootstrap SelectPicker"),e.parent().css("z-index","auto"))}},{key:"_showOverlayElements",value:function(t){var e=0==$(document$1).find(".popover.tour-"+this._options.name+".tour-"+this._options.name+"-"+this.getCurrentStepIndex()).length;t.preventInteraction&&!e&&($(t.backdropContainer).append("<div class='tour-prevent' id='tourPrevent'></div>"),$("#tourPrevent").width($(t.element).outerWidth()),$("#tourPrevent").height($(t.element).outerHeight()),$("#tourPrevent").offset($(t.element).offset()));var o=$(document$1).height(),n=$(document$1).width();if(0===$(t.element).length||this._isOrphan(t)){var i=$('<div class="tour-backdrop tour-backdrop-orphan"></div>');i.offset({top:0,left:0}),i.width(n),i.height(o),$("body").append(i)}else{var r={width:$(t.element).innerWidth(),height:$(t.element).innerHeight(),offset:$(t.element).offset()};t.backdropPadding&&(this._applyBackdropPadding(t.backdropPadding,r),_readOnlyError("elementData"));var s=$('<div class="tour-backdrop top"></div>');s.offset({top:0,left:0}),s.width(n),s.height(r.offset.top);var a=$('<div class="tour-backdrop left"></div>');a.width(r.offset.left),a.height(r.height),a.offset({top:r.offset.top,left:0});var l=$('<div class="tour-backdrop right"></div>');l.width(n-(r.width+r.offset.left)),l.height(r.height),l.offset({top:r.offset.top,left:r.offset.left+r.width});var u=$('<div class="tour-backdrop bottom"></div>');u.width(n),u.height(o-r.offset.top-r.height),u.offset({top:r.offset.top+r.height,left:0}),$(t.backdropContainer).append(s),$(t.backdropContainer).append(a),$(t.backdropContainer).append(l),$(t.backdropContainer).append(u)}}},{key:"_hideOverlayElement",value:function(t){$("#tourPrevent").length&&$("#tourPrevent").remove(),$(".tour-backdrop").remove()}},{key:"_applyBackdropPadding",value:function(t,e){return"object"===_typeof(t)?(null==t.top&&(t.top=0),null==t.right&&(t.right=0),null==t.bottom&&(t.bottom=0),null==t.left&&(t.left=0),e.offset.top=e.offset.top-t.top,e.offset.left=e.offset.left-t.left,e.width=e.width+t.left+t.right,e.height=e.height+t.top+t.bottom):(e.offset.top=e.offset.top-t,e.offset.left=e.offset.left-t,e.width=e.width+2*t,e.height=e.height+2*t),e}},{key:"_clearTimer",value:function(){return window.clearTimeout(this._timer),this._timer=null,this._duration=null}},{key:"_getProtocol",value:function(t){return(t=t.split("://")).length>1?t[0]:"http"}},{key:"_getHost",value:function(t){return(t=(t=t.split("//")).length>1?t[1]:t[0]).split("/")[0]}},{key:"_getPath",value:function(t){return t.replace(/\/?$/,"").split("?")[0].split("#")[0]}},{key:"_getQuery",value:function(t){return this._getParams(t,"?")}},{key:"_getHash",value:function(t){return this._getParams(t,"#")}},{key:"_getParams",value:function(t,e){var o=t.split(e);if(1===o.length)return{};for(var n={},i=0,r=(o=o[1].split("&")).length;i<r;i++){var s=o[i];n[(s=s.split("="))[0]]=s[1]||""}return n}},{key:"_equal",value:function(t,e){if(LS.ld.isObject(t)&&LS.ld.isObject(e)){var o=Object.keys(t),n=Object.keys(e);if(o.length!==n.length)return!1;for(var i in t){var r=t[i];if(!this._equal(e[i],r))return!1}return!0}if(LS.ld.isArray(t)&&LS.ld.isArray(e)){if(t.length!==e.length)return!1;for(var s=j=0,a=t.length;j<a;s=++j){var l=t[s];if(!this._equal(l,e[s]))return!1}return!0}return t===e}}]),t}(),globalTourObject=function globalTourObject(){var getBasedUrls=/(\/index.php)?\?r=admin/.test(window.location.href),combineParams=function(t){return!1===t?"":"/"+LS.ld.reduce(t,(function(t,e,o){return t+(""===t?"":"/")+o+"/"+e}),"")},filterUrl=function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];"/"==t.charAt(0)&&(t=t.substring(1));var n=getBasedUrls||o?"?r=admin/":"/admin/",i=/\/index.php\/?/.test(window.location.href),r=window.LS.data.baseUrl+(i?"/index.php":"")+n+t+combineParams(e);return r},_preparePath=function(t){return"string"==typeof t?t:RegExp(t.join())},_prepareMethods=function _prepareMethods(tutorialObject){return tutorialObject.steps=LS.ld.map(tutorialObject.steps,(function(step,i){return step.path=_preparePath(step.path),step.onNext=step.onNext?eval(step.onNext):void 0,step.onShow=step.onShow?eval(step.onShow):void 0,step.onShown=step.onShown?eval(step.onShown):void 0,step.onHide=step.onHide?eval(step.onHide):void 0,step.onHidden=step.onHidden?eval(step.onHidden):void 0,step})),tutorialObject.onShown=tutorialObject.onShown?eval(tutorialObject.onShown):null,tutorialObject.onEnd=tutorialObject.onEnd?eval(tutorialObject.onEnd):null,tutorialObject.onStart=tutorialObject.onStart?eval(tutorialObject.onStart):null,tutorialObject};return{get:function(t){return new Promise((function(e,o){$.ajax({url:filterUrl("/tutorial/sa/servertutorial"),data:{tutorialname:t,ajax:!0},method:"POST",success:function(t){var o=_prepareMethods(t.tutorial);e(o)},error:function(t){o(t)}})}))}}},globalTourObject$1=globalTourObject(),TourLibrary=function(){var t=function(){return window.localStorage.getItem("lstutorial-is-tour-active")||!1},e=function(t){window.localStorage.removeItem("lstutorial-is-tour-active"),void 0!==t&&$.post(LS.data.baseUrl+("path"==LS.data.urlFormat?"/admin/tutorial/sa/triggerfinished/tid/":"?r=admin/tutorial/sa/triggerfinished/tid/")+t)},o=function(){"object"===_typeof(r)&&null!==r&&r.end(),e()},n=function(n){return new Promise((function(i,s){!1!==t()&&t()!==n&&(o(),s()),globalTourObject$1.get(n).then((function(t){!function(t){window.localStorage.setItem("lstutorial-is-tour-active",t)}(n),t.onEnd=function(){e(t.tid)},t.debug=window.debugState.backend,t.framework="bootstrap3",r=new Tour(t),window.addEventListener("resize",(function(){r.redraw()})),i(r)}),console.ls.err)}))},i=t(),r=null;return!1!==i&&"function"!=typeof r&&n(i).then((function(t){t.ended()?t.restart():setTimeout((function(){t.start()}),1)}),(function(t){console.ls.log("Couldn't be loaded!"),console.ls.error(t)})),{triggerTourStart:function(t){o(),n(t).then((function(t){t.ended()?t.restart():t.start(!0)}),(function(t){console.ls.log("Couldn't be loaded!"),console.ls.error(t)}))},clearActiveTour:o,initTour:n,_actionActiveTour:r,getCurrentStep:function(){if(!1!==t())return globalTourObject$1.getCurrentStep()}}};$(document).on("ready pjax:scriptcomplete",(function(){void 0===window.tourLibrary&&(window.tourLibrary=TourLibrary()),$("#selector__welcome-modal--starttour").on("click",(function(t){$(t.currentTarget).closest(".modal").modal("hide"),window.tourLibrary.triggerTourStart("firstStartTour")}))}))}));
